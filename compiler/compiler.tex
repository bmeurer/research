\documentclass[12pt,a4paper]{article}

\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{amstext}
\usepackage{array}
\usepackage[american]{babel}
\usepackage{color}
\usepackage{enumerate}
\usepackage[a4paper,%
            colorlinks=false,%
            final,%
            pdfkeywords={},%
            pdftitle={},%
            pdfauthor={Benedikt Meurer},%
            pdfsubject={},%
            pdfdisplaydoctitle=true]{hyperref}
\usepackage{ifthen}
\usepackage[latin1]{inputenc}
\usepackage{latexsym}
\usepackage[final]{listings}
\usepackage{makeidx}
\usepackage{ngerman}
\usepackage[standard,thmmarks]{ntheorem}
\usepackage{stmaryrd}

%% LaTeX macros
\include{macros}

\begin{document}


\section{Rekursion und Iteration}

Seien $A,B$ disjunkte Mengen und sei $g: A \times B^* \pto A \uplus B$. Dann definieren wir
drei bin"are Relationen
\[\begin{array}{rcl}
  \Downarrow & \subseteq & A \times B \\
  \multimap  & \subseteq & A \times A \\
  \step      & \subseteq & (A \uplus B)^* \times (A \uplus B)^*
\end{array}\]
induktiv durch folgende Regeln (f"ur alle $n \ge 0$):
\begin{enumerate}
\item Wenn $a_i \Downarrow b_i$ f"ur $i=1,\ldots,n$ \\
  und $g(a,b_1 \ldots b_{i-1}) = a_i$ f"ur $i = 1,\ldots,n$ \\
  und $g(a,b_1 \ldots b_n) = b$ \\
  dann $a \Downarrow b$.
\item Wenn $a_i \Downarrow b_i$ f"ur $i=1,\ldots,n$ \\
  und $g(a,b_1 \ldots b_{i-1})=a_i$ f"ur $i=1,\ldots,n$ \\
  dann $a \multimap a_n$.
\item Wenn $g(a,b_1 \ldots b_n) = a'$ \\
  dann $w\,a\,b_1 \ldots b_n \step w\,a\,b_1 \ldots b_n\,a'$.
\item Wenn $g(a,b_1 \ldots b_n) = b$ \\
  dann $w\,a\,b_1 \ldots b_n \step w\,b$.
\end{enumerate}
Um im Folgenden ausschlie"slich \emph{sinnvolle} Semantiken zu erhalten, fordern wir, dass $g$
keine \emph{L"ucken} aufwei"st.
\begin{definition}
  $g: A \times B^* \pto A \uplus B$ hei"st \emph{vollst"andig}, wenn f"ur alle $n \in \N$, $a,a'\in A$
  und $b,b_1,\ldots,b_{n+1} \in B$ gilt: 
  Wenn $g(a,b_1 \ldots b_{n+1}) = a'$ oder $g(a,b_1 \ldots b_{n+1}) = b$ dann
  existieren $a_1',\ldots,a_n' \in A$ so dass $g(a,b_1 \ldots b_i) = a_i'$ f"ur alle $i = 1,\ldots,n$.
\end{definition}


\section{Offset-eindeutigkeit}

Die naive iterative Umsetzung, die anfangs beschrieben wurde, verwaltet Argumente und Resultate auf einem einzigen
Stack. Grund hierf"ur ist unter anderem das die Argumente f"ur das sogenannte \emph{Framing} ben"otigt werden.
Hinter jedem Argument $a$ findet sich jeweils eine Liste von Resultaten $b_1 \ldots b_n$ bevor sich das n"achste
Argument $a'$ anschlie"st (oder das Ende des Stacks erreicht ist). Diese Resultate $b_1 \ldots b_n$ bilden die
bereits berechneten Zwischenresultate von $a$. Der Teilabschnitt $a\,b_1 \ldots b_n$ des Stacks wird dann als
\emph{Frame von $a$} bezeichnet.

Mittels dieses Mechanismus ist stets eindeutig zu erkennen, wieviele Zwischenresultate von $a$ bereichts
berechnet wurden, und wie anhand dieser weiter vorzugehen ist. W"urde man die Argumente auf einem separaten
Stack verwalten, ohne weitere Markierungen f"ur den Resultatstack, die das Erkennen von Frames erm"oglichen,
einzuf"uhren, so w"are im Allgemeinen eine Zuordnung der Zwischenresultate unm"oglich. Aber erst durch eine
(weitgehend) getrennte Verwaltung von Argumenten und Resultaten werden interessante Optimierungen, wie z.B.
das Weglassen von "uberfl"ussigen Argumenten oder Resultaten, m"oglich.

Betrachten wir dazu zun"achst ein einfaches Beispiel. Sei $g$ wie folgt definiert:
\[\begin{array}{lclclclclcllclc}
  a &\mapsto& a_1 &\quad& a,b &\mapsto& a_2 &\quad& && &\quad& \\
  a_1 &\mapsto& b \\
  a_2 &\mapsto& a_3 && a_2,b &\mapsto& b_1 && a_2,b_2 &\mapsto& a_4 && a_2,b\,b_2 &\mapsto& a_5 \\
  a_3 &\mapsto& b_2 \\
  &\vdots&
\end{array}\]
Die Berechnung von $a$ in der naiven iterativen Umsetzung sieht dann wie folgt aus:
\[\begin{array}{c}
a \step a\,a_1 \step a\,b \step a\,b\,a_2 \step a\,b\,a_2\,a_3 \step a\,b\,a_2\,b_2 \step a\,b\,a_2\,a_4 \step \ldots
\end{array}\]
W"urde man nun Argumente und Resultate auf zwei unabh"angigen Stacks verwalten, so w"urde die
Berechnung f"ur $a$ wie zuvor mit
\[\begin{array}{c}
(a) \step (a\,a_1) \step (a,b) \step (a\,a_2,b)
\end{array}\]
beginnen, aber ab hier w"are es nicht mehr eindeutig, wie weiter zu verfahren ist. Denn f"ur $b$ ist
unklar ob es ein Zwischenresultat von $a$ oder $a_2$ ist. Ersteres w"urde bedeuten, dass
\[\begin{array}{c}
(a\,a_2,b) \step (a\,a_2\,a_3,b)
\end{array}\]
der n"achste Schritt w"are, denn $g(a_2)=a_3$, w"ahrend letzteres bedeuten w"urde, dass mit
\[\begin{array}{c}
(a\,a_2,b) \step (a,b_1)
\end{array}\]
fortgefahren werden m"usste, denn $g(a_2,b)=b_1$. Ausgehend von der Annahme, dass die Berechnung den \emph{richtigen}
Weg -- also den ersten -- nehmen w"urde, erg"abe sich dann nach
\[\begin{array}{c}
(a\,a_2,b) \step (a\,a_2\,a_3,b) \step (a\,a_2,b\,b_2)
\end{array}\]
das n"achste Problem. Hier existieren sogar drei verschiedene M"oglichkeiten fortzufahren, abh"angig
davon, ob man animmt, dass f"ur $a_2$ noch keine Zwischenresultat, ein Zwischenresultat $b_2$ oder zwei
Zwischenresultate $b\,b_2$ vorliegen.

Intuitiv ist jedoch stets klar, wie weiter vorgegangen werden m"usste. F"ur das erste Problem wissen wir,
dass wir in der Berechnung \emph{vor} $a_3$ stehen, d.h. es k"onnen noch keine Zwischenergebnisse f"ur $a_3$
vorliegen. Beim zweiten Problem ist klar, dass sich die Berechnung nun \emph{hinter} $a_3$ befindet und das
Ergebnis ist $b_2$. Da $a_3$ nur dann als Nachfolger von $a_2$ auftreten kann, wenn vorher keine
Zwischenresultate f"ur $a_2$ vorlagen, ergibt sich daraus sofort, dass genau ein Zwischenresultat f"ur $a_2$
vorliegen muss, wenn man \emph{hinter} $a_3$ steht. Formalisieren wir zun"achst, was wir unter Nachfolgern
eines Arguments verstehen:

\begin{definition}[Nachfolger]
  Sei $g: A \times B^* \pto A \uplus B$ und sei $a \in A$. Die Menge aller \emph{Nachfolger} von $a$ ist
  definiert durch
  \[\begin{array}{rcl}
    \children_g(a) = \{a' \in A \mid \exists n \in \N,b_1,\ldots,b_n \in B.\,g(a,b_1 \ldots b_n) = a'\}.
  \end{array}\]
\end{definition}

F"ur jeden Nachfolger $a'$ eines Arguments $a$ existiert also mindestens ein $n \in N$, welches die Anzahl
der zuvor bestimmten Zwischenergebnisse angibt. Diese $n$ bezeichnen wir als die \emph{relativen Offsets}
von $a'$ bzgl. $a$.

\begin{definition}[Relative und absolute Offsets]
  Sei $g: A \times B^* \pto A \uplus B$ und seien $a,a' \in A$. Die Menge aller \emph{relativen Offsets}
  von $a'$ bzgl. $a$ ist definiert durch
  \[\begin{array}{rcl}
    \offsets_g(a,a') &=& \{n \in \N \mid \exists b_1,\ldots,b_n \in B.\, g(a,b_1 \ldots b_n) = a'\},
  \end{array}\]
  und die Menge aller \emph{absoluten Offsets} von $a'$ ist definiert durch
  \[\begin{array}{rcl}
    \offsets_g(a') &=& \bigcup_{a \in A} \offsets_g(a,a').
  \end{array}\]
  Die Funktion $g$ hei"st
  \begin{enumerate}
  \item \emph{relativ offset-eindeutig} falls $|\offsets_g(a,a')| \le 1$ f.a. $a,a' \in A$, bzw.
  \item \emph{(absolut) offset-eindeutig} falls $|\offsets_g(a')| \le 1$ f.a. $a' \in A$.
  \end{enumerate}
\end{definition}

Im obigen Beispiel wissen wir, dass $0$ das einzige relative Offset f"ur $a_3$ bzgl. $a_2$ ist. Dies
erlaubt uns den R"uckschluss, dass nach der Berechnung f"ur $a_3$ exakt ein Zwischenresultat f"ur
$a_2$ vorliegt. Genaugenommen wissen wir sogar, dass die Funktion $g$ aus dem Beispiel -- zumindest
soweit sie angegeben ist -- absolut offset-eindeutig ist, denn f"ur jedes Argument existiert
nur h"ochstens ein absolutes Offset.

Weiterhin m"ussen wir nun noch formalisieren, was es bedeutet, in der Berechnung \emph{vor} oder
\emph{hinter} einem Argument zu stehen. Intuitiv haben wir diese Information aus den vorangegangenen
Konfigurationen abgeleitet. Es ist jedoch im Allgemeinen nicht m"oglich diese Information -- d.h.
ob man \emph{vor} oder \emph{hinter} einem Argument steht -- aus einer einzigen Konfiguration zu
gewinnen. Dementsprechend muss diese Information in Konfigurationen explizit gemacht werden. Dazu
markieren wir jeweils das aktuelle Argument mit einem Punkt vor dem Argument, um deutlich zu machen,
dass die Berechnung \emph{vor} selbigem steht, bzw. hinter dem Argument, um deutlich zu machen, dass
die Berechnung \emph{hinter} dem Argument steht.

\begin{definition}[Punktierte Mengen]
  Sei $M$ eine beliebige Menge. Die Menge $\dot{M}$ aller \emph{punktierten Elemente} aus
  $M$ ist definiert durch
  \[\begin{array}{rcl}
    \dot{M} &=& \{\cdot m \mid m \in M\} \cup \{m \cdot \mid m \in M\}.
  \end{array}\]
\end{definition}

Als Konfigurationen w"ahlen wir Tripel, wobei das erste Element das punktierte aktuelle Argument
enth"alt, das zweite Element den Stack der vorangegangenen Argumente und das dritte Element den
Resultatstack. D.h. $\dot{A} \times A^* \times B^*$ ist die Menge aller m"oglichen Konfigurationen.
Auf dieser Menge definieren wir nun zu jedem relativ offset-eindeutigen $g$ eine bin"are Relation
$\step$ als die kleinste Relation, f"ur die gilt:
\begin{enumerate}
\item Wenn $g(a) = b$ \\
  dann $(\cdot a,v,w) \step (a \cdot,v,w\,b)$.
\item Wenn $g(a) = a'$ \\
  dann $(\cdot a,v,w) \step (\cdot a',v\,a,w)$.
\item Wenn $g(a,b_1 \ldots b_n) = a'$ und $g(a,b_1 \ldots b_{n+1}) = b$ \\
  dann $(a' \cdot,v\,a,w\,b_1 \ldots b_{n+1}) \step (a \cdot,v,w\,b)$.
\item Wenn $g(a,b_1 \ldots b_n) = a'$ und $g(a,b_1 \ldots b_{n+1}) = a''$ \\
  dann $(a' \cdot,v\,a,w\,b_1 \ldots b_{n+1}) \step (\cdot a'',v\,a,w\,b_1 \ldots b_{n+1})$.
\end{enumerate}

Die ersten beiden Regeln beschreiben die m"oglichen Konfigurations"uberg"ange, wenn sich die Berechnung
\emph{vor} einem Argument $a$ befindet. Hier existieren zwei M"oglichkeiten: Entweder liefert $g$ sofort
ein Resultat $b$, dann wird der Punkt hinter das $a$ gesetzt und das Resultat auf den Stack gelegt. Oder
$g$ liefert einen Nachfolger $a'$ f"ur $a$, dann wird $a$ auf den Vorg"angerstack gelegt und die Berechnung
f"ahrt mit $\cdot a'$ fort.

Steht nun die Berechnung hinter $a'$ und ist $a$ der $n$-te Vorg"anger von $a'$, so m"ussen $n+1$
Zwischenresultate f"ur $a$ auf dem Resultatstack liegen, denn $g$ ist nach Voraussetzung relativ
offset-eindeutig. Liefert nun $g(a,b_1 \ldots b_{n+1})$ ein Resultat $b$, so greift die dritte
Regel: Hier werden die Zwischenresultate f"ur $a$ auf dem Resultatstack durch $b$ ersetzt, das
Argument $a$ vom Vorg"angerstack entfernt und anschlie"send die Berechnung hinter $a$ fortgesetzt.
Liefert andererseits $g(a,b_1 \ldots b_{n+1})$ einen weiteren Nachfolger $a''$, so wird die Berechnung
vor $a''$ fortgesetzt.

Anhand dieser Erl"auterungen ist unmittelbar ersichtlich, dass die so definierte "Ubergangsrelation
\emph{deterministisch} ist, d.h. dass zu jeder Konfiguration $\zeta$ nur h"ochstens eine Konfiguration
$\zeta'$ existiert, so dass $\zeta \step \zeta'$ gilt. Weiterhin gilt folgende Berechnungsinvariante:
\begin{lemma}
  Sei $a \in A$ und $b \in B$. Dann gilt
  $(\cdot a,\varepsilon,\varepsilon) \step^* (a \cdot, b, \varepsilon)$
  genau dann wenn $a \Downarrow b$.
\end{lemma}


\section{Vorg"anger-eindeutigkeit}

\begin{definition}[Vorg"anger]
  Sei $g: A \times B^* \pto A \uplus B$ und sei $a'\in A$. Die Menge aller \emph{Vorg"anger} von
  $a'$ ist definiert durch
  \[\begin{array}{rcl}
    \parents_g(a') &=& \{a \in A \mid \offsets_g(a,a') \ne \emptyset \}.
  \end{array}\]
  $g$ hei"st \emph{vorg"anger-eindeutig} falls $|\parents_g(a')| \le 1$ f.a. $a' \in A$.
\end{definition}

Zwischen Vorg"anger-eindeutigkeit und Offset-eindeutigkeit besteht folgender Zusammenhang: Ist
eine Funktion $g$ relativ offset-eindeutig und vorg"anger-eindeutig, so ist $g$ auch absolut
offset-eindeutig.


\end{document}