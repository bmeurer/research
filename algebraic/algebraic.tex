\documentclass[%
  12pt,%
  a4paper,%
%  draft,%
]{article}

\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{amstext}
\usepackage{array}
\usepackage[american]{babel}
\usepackage{color}
\usepackage{enumerate}
\usepackage[a4paper,%
            colorlinks=false,%
            final,%
            pdfkeywords={},%
            pdftitle={},%
            pdfauthor={Benedikt Meurer},%
            pdfsubject={},%
            pdfdisplaydoctitle=true]{hyperref}
\usepackage{ifthen}
\usepackage[latin1]{inputenc}
\usepackage{latexsym}
\usepackage[final]{listings}
\usepackage{makeidx}
\usepackage{mathpartir}
\usepackage{ngerman}
\usepackage[standard,thmmarks]{ntheorem}
\usepackage{stmaryrd}
\usepackage{varwidth}

%% LaTeX macros
\include{macros}

\DeclareMathOperator{\as}{\textbf{as}}
\newcommand{\any}{\textbf{any}}

\newcommand{\tj}[2]{{#1}\div{#2}}
\newcommand{\Tj}[3]{{#1}\vdash{#2}\div{#3}}

\begin{document}


\section*{Abstrakte Syntax}

Die Mengen $\Spec$ aller \emph{(Bindungs-)Spezifikationen} $\sigma$ und
$\Type$ aller \emph{(Bindungs-)Typen} $\tau$ sind definiert durch die
folgende kontextfreie Grammatik:
\[\begin{grammar}
  \sigma \in \Spec
  \is \Dynamic
  \al \Static{i} & i \ge 1
  \nl
  \tau \in \Type
  \is \langle \sigma_1,\ldots,\sigma_n \rangle & n \ge 0
  \nl
\end{grammar}\]
Eine Bindungsspezifikation $\gamma$ bzw. ein Bindungstyp $\tau$ hei"st \emph{g\"ultig bzgl. $k \in \N$},
geschrieben $\sigma \preceq k$ bzw. $\tau \preceq k$, wenn sich dies mit den folgenden Regeln herleiten
l"a"st:
\begin{mathpar}
  \inferrule{%
  }{%
    \Dynamic \preceq k
  }%
  \and
  \inferrule{%
    i \le k
  }{%
    \Static{i} \preceq k
  }%
  \and
  \inferrule{%
    \sigma_1 \preceq k \\
    \ldots \\
    \sigma_n \preceq k
  }{%
    \langle \sigma_1,\ldots,\sigma_n \rangle \preceq k
  }%
\end{mathpar}
Intuitiv bedeutet $\tau \preceq k$, dass alle statischen Spezifikationen in $\tau$ innerhalb des
Intervalls $[1,k]$ liegen.

Eine \emph{Syntaxsignatur} $\Psi = \langle \mathcal{C}, \delta \rangle$ besteht
aus einer Menge $\mathcal{C}$ von \emph{Konstruktoren} $\zeta$ und einer
(totalen) Funktion $\delta: \mathcal{C} \to \bigcup_{n\in\N}\Type^n$, welche jedem Konstruktor
eine Stelligkeit und damit verbundene Bindungstypen zuordnet.
Sei $\Id$ eine (unendliche) Menge von \emph{Bezeichnern} $\id$.
Die Menge $\Exp(\Psi)$ aller $\Psi$-Ausdr\"ucke $e$ ist definiert durch:
\[\begin{grammar}
  e \in \Exp(\Psi)
  \is \id & \id \in \Id
  \al \zeta(e_1,\ldots,e_n) & \zeta \in \mathcal{C}
  \al \Lambda \id_1:\sigma_1,\ldots,\id_n:\sigma_n.e & n \ge 1
  \nl
\end{grammar}\]
Ein \emph{Typurteil f\"ur $\Psi$-Ausdr\"ucke} ist eine Formel der Gestalt $\tj{e}{\tau}$. Ein solches
Typurteil hei"st \emph{g\"ultig}, wenn es sich mit den folgenden Regeln herleiten
l"a"st:
\begin{mathpar}
  \inferrule[(Id)]{%
  }{%
    \tj{\id}{\langle \rangle}
  }%
  \and
  \inferrule[(Bind)]{%
    \tj{e}{\langle \rangle}
  }{%
    \tj{\Lambda\id_1:\sigma_1,\ldots,\id_n:\sigma_n.e}{\langle \sigma_1,\ldots,\sigma_n \rangle}
  }%
  \and
  \inferrule[(Cons)]{%
    \delta(\zeta)=\tau_1 \ldots \tau_n \\
    \tj{e_i}{\tau_i} \\
    \tau_i \preceq n \\
    i=1,\ldots,n
  }{%
    \tj{\zeta(e_1,\ldots,e_n)}{\langle \rangle}
  }%
\end{mathpar}
$\free(e)$ ist wie \"ublich definiert; ein Ausdruck $e$ hei"st \emph{abgeschlossen},
wenn $\free(e) = \emptyset$. Ein \emph{Programm} ist ein abgeschlossener Ausdruck
vom Typ $\langle \rangle$.


\subsection*{Pattern und Terme}

Sei $\Var$ eine (unendliche) Menge von \emph{Variablen}.
Die Mengen $\Pat(\Psi)$ aller \emph{$\Psi$-Pattern} $\pi$ und $\Term(\Psi)$ aller
\emph{$\Psi$-Terme} $t$ sind definiert durch die folgende kontextfreie Grammatik:
\[\begin{grammar}
  \pi \in \Pat(\Psi)
  \is \any
  \al \pi \as X
  \al \zeta(\pi_1,\ldots,\pi_n)
  \nl
  t \in \Term(\Psi)
  \is X
  \al t \langle t_1,\ldots,t_n \rangle & n \ge 1
  \al \zeta(t_1,\ldots,t_n)
  \nl
\end{grammar}\]
Eine \emph{Typumgebung} ist eine partielle, endliche Abbildung $\Gamma:\Var \pto \Type$.
Ein \emph{Typurteil f\"ur $\Psi$-Pattern} ist eine Formel der Gestalt $\Tj{\Gamma}{\pi}{\tau}$. Ein
derartiges Typurteil hei"st \emph{g\"ultig}, wenn es sich mit den folgenden Regeln herleiten
l"a"st:
\begin{mathpar}
  \inferrule[(Any)]{%
  }{%
    \Tj{\Gamma}{\any}{\tau}
  }%
  \and
  \inferrule[(As)]{%
    \Tj{\Gamma}{\pi}{\tau} \\
    \Gamma(X) = \tau
  }{%
    \Tj{\Gamma}{\pi \as X}{\tau}
  }%
  \and
  \inferrule[(Cons)]{%
    \delta(\zeta)=\tau_1 \ldots \tau_n \\
    \Tj{\Gamma}{\pi_i}{\tau_i} \\
    \tau_i \preceq n \\
    i=1,\ldots,n
  }{%
    \Tj{\Gamma}{\zeta(\pi_1,\ldots,\pi_n)}{\langle \rangle}
  }%
\end{mathpar}
Ein \emph{Typurteil f\"ur $\Psi$-Terme} ist eine Formel der Gestalt $\Tj{\Gamma}{t}{\tau}$, und
hei"st \emph{g\"ultig}, wenn es sich mit den folgenden Regeln herleiten l"a"st:
\begin{mathpar}
  \inferrule[(Var)]{%
    \Gamma(X) = \tau
  }{%
    \Tj{\Gamma}{X}{\tau}
  }%
  \and
  \inferrule[(Cons)]{%
    \delta(\zeta)=\tau_1 \ldots \tau_n \\
    \Tj{\Gamma}{t_i}{\tau_i} \\
    \tau_i \preceq n \\
    i=1,\ldots,n
  }{%
    \Tj{\Gamma}{\zeta(t_1,\ldots,t_n)}{\langle \rangle}
  }%
  \and
  \inferrule[(App)]{%
    \Tj{\Gamma}{t}{\langle\sigma_1,\ldots,\sigma_n\rangle} \\
    \Tj{\Gamma}{t_i}{\langle \rangle} \\
    \sigma_i \preceq n \\
    i=1,\ldots,n
  }{%
    \Tj{\Gamma}{t\langle t_1,\ldots,t_n \rangle}{\langle \rangle}
  }%
\end{mathpar}


\section*{Semantik}

Eine \emph{$\Psi$-Implementierung} $\mathcal{D}$ ist eine Struktur $(D,\sem{\cdot}_D)$, bestehend aus
\begin{itemize}
\item einer nicht-leeren \emph{Tr\"agermenge $D$} mit Teilmengen $D^\tau \subseteq D$ f\"ur jeden Typ
  $\tau \in \Type$, und
\item einer \emph{Funktionsbelegung $\sem{\cdot}_D$}, welche den (Familien von) Funktionszeichen
  $\App_n$ $(n \ge 1)$, $\Child_n^i$ $(n \ge i \ge 1)$, $\Compose_n$ $(n \ge 0)$ und $\Label$ Funktionen
  nach folgendem Schema zuordnet:
  \[\begin{array}{ll}
    \sem{\App_n}_D: D \times \underbrace{D \times \ldots \times D}_n \pto D &
    \sem{\Child_n^i}_D: D \pto D \\
    \sem{\Compose_n}_D: \zeta \times \underbrace{D \times \ldots \times D}_n \pto D &
    \sem{\Label}_D: D \pto \zeta \\
  \end{array}\]
\end{itemize}
Eine Implementierung $\mathcal{D}$ hei"st \emph{g\"ultig}, wenn gilt:
\begin{enumerate}
\item Wenn $d_0 \in D^{\langle \sigma_1,\ldots,\sigma_n \rangle}$ und $d_i \in D^{\langle \rangle}$ f\"ur $i=1,\ldots,n$,
  dann existiert ein $d \in D^{\langle \rangle}$, so dass $d = \sem{\App_n}_D(d_0,d_1,\ldots,d_n)$.
\item Wenn $\delta(\zeta) = \tau_1\ldots\tau_n$ und $d_i \in D^{\tau_i}$ f\"ur $i=1,\ldots,n$,
  dann existiert ein $d \in D^{\langle \rangle}$, so dass $d = \sem{\Compose_n}_D(\zeta,d_1,\ldots,d_n)$
  und $\zeta = \sem{\Label}_D(d)$.
\item Wenn $\delta(\zeta) = \tau_1\ldots\tau_n$, $d \in D^{\langle \rangle}$ und $\zeta = \sem{\Label}_D(d)$, dann
  existieren $d_1 \in D^{\tau_1},\ldots,d_n \in D^{\tau_n}$, so dass $\sem{\Child_n^i}_D(d) = d_i$ f\"ur $i=1,\ldots,n$.
\end{enumerate}
Wir identifizieren $\mathcal{D}$ mit $D$.

\subsection*{Semantik von Patterns und Termen}

Eine \emph{$D$-Belegung} ist eine partielle, endliche Abbildung $\varrho: \Var \pto D$. Eine Belegung
$\varrho$ hei"st \emph{g"ultig bzgl. einer Typumgebung $\Gamma$}, geschrieben $\Gamma \vdash \varrho$,
wenn gilt:
\begin{enumerate}
\item $\dom(\Gamma) = \dom(\varrho)$
\item $\varrho(X) \in D^{\Gamma(X)}$ f"ur alle $X \in \dom(\Gamma)$
\end{enumerate}
Die Menge aller g"ultigen Belegungen bzgl. $\Gamma$ bezeichnen wir mit $\Assn(\Gamma)$.
Sei im Folgenden $\varrho \in \Assn(\Gamma)$.
Jedem g"ultigen Typurteil $\Tj{\Gamma}{\pi}{\tau}$ wird wie folgt induktiv
eine Semantik $D\sem{\Tj{\Gamma}{\pi}{\tau}}\,\varrho \subseteq D$ zugeordnet:
\[\begin{array}{rcl}
  D\sem{\Tj{\Gamma}{\any}{\tau}}\,\varrho
  &=& D^\tau
  \\
  D\sem{\Tj{\Gamma}{\pi \as X}{\tau}}\,\varrho
  &=& \{d \in D\sem{\Tj{\Gamma}{\pi}{\tau}}\,\varrho \mid d = \varrho(X) \}
  \\
  D\sem{\Tj{\Gamma}{\zeta(\pi_1,\ldots,\pi_n)}{\langle \rangle}}\,\varrho
  &=& \{ d \in D^{\langle \rangle} \mid \sem{\Label}_D(d) = \zeta \text{ und} \\
  && \quad \sem{\Child_n^i}_D(d) = D\sem{\Tj{\Gamma}{\pi_i}{\tau_i}}\,\varrho \\
  && \quad \text{f\"ur $i=1,\ldots,n$} \}
  \\
\end{array}\]
Ebenso wird jedem g"ultigen Typurteil $\Tj{\Gamma}{t}{\tau}$ wird wie folgt induktiv
eine Semantik $D\sem{\Tj{\Gamma}{t}{\tau}}\,\varrho \in D$ zugeordnet:
\[\begin{array}{rcl}
  D\sem{\Tj{\Gamma}{X}{\tau}}\,\varrho
  &=& \varrho(X)
  \\
  D\sem{\Tj{\Gamma}{t \langle t_1,\ldots,t_n \rangle}{\langle \rangle}}\,\varrho
  &=& \sem{\App_n}_D(d, d_1, \ldots, d_n) \\
  & \multicolumn{2}{l}{\text{mit } d = D\sem{\Tj{\Gamma}{t}{\langle\sigma_1,\ldots,\sigma_n\rangle}}\,\varrho} \\
  & \multicolumn{2}{l}{\text{und } d_i = D\sem{\Tj{\Gamma}{t_i}{\langle \rangle}}\,\varrho \text{ f\"ur $i=1,\ldots,n$}}
  \\
  D\sem{\Tj{\Gamma}{\zeta(t_1,\ldots,t_n)}{\langle \rangle}}\,\varrho
  &=& \sem{\Compose_n}_D(\zeta,d_1,\ldots,d_n) \\
  & \multicolumn{2}{l}{\text{mit } d_i = D\sem{\Tj{\Gamma}{t_i}{\tau_i}}\,\varrho \text{ f\"ur $i=1,\ldots,n$}}
  \\
\end{array}\]

\begin{lemma}[Wohldefiniertheit der Semantik] \label{lem:Wohldefiniertheit_der_Semantik}
  Sei $D$ eine g"ultige Implementierung, und $\varrho \in \Assn(\Gamma)$.
  \begin{enumerate}
  \item Zu jedem $\Tj{\Gamma}{\pi}{\tau}$ ex. genau ein $D' \subseteq D^\tau$ mit
    $D\sem{\Tj{\Gamma}{\pi}{\tau}}\,\varrho = D'$.
  \item Zu jedem $\Tj{\Gamma}{t}{\tau}$ ex. genau ein $d \in D^\tau$ mit
    $D\sem{\Tj{\Gamma}{t}{\tau}}\,\varrho = d$.
  \end{enumerate}
\end{lemma}

\begin{proof}
  Sollte klar sein.
\end{proof}

\subsection*{"Aquivalenz}

Seien $D$ und $E$ $\Psi$-Implementierungen. Zwei Teilmengen $D' \subseteq D$ und $E' \subseteq E$
hei"sen \emph{$\Delta$-"aquivalent}, geschrieben $D' \sim_\Delta E'$, wenn gilt:
\begin{enumerate}
\item Zu jedem $d \in D'$ existiert ein $e \in E'$ so dass $(d,e) \in \Delta$.
\item Zu jedem $e \in E'$ existiert ein $d \in D'$ so dass $(d,e) \in \Delta$.
\end{enumerate}

\begin{definition}["Aquivalenz von Implementierungen] \label{def:Aequivalenz_von_Implementierungen}
  Seien $D$ und $E$ $\Psi$-Implementierungen und $\Delta \subseteq D \times E$. $D$ und $E$ hei"sen
  \emph{$\Delta$-"aquivalent}, geschrieben $D \sim_\Delta E$, wenn \[D^\tau \sim_\Delta E^\tau\] f"ur
  alle $\tau \in \Type$ und f"ur alle $(\hat{d},\hat{e}),(d_1,e_1),\ldots,(d_n,e_n) \in \Delta$ gilt:
  \begin{enumerate}
  \item Wenn $\sem{\App_n}_D(\hat{d},d_1,\ldots,d_n) = d$ und $\sem{\App_n}_E(\hat{e},e_1,\ldots,e_n) = e$,
    dann $(d,e) \in \Delta$.
  \item Wenn $\sem{\Compose_n}_D(\zeta,d_1,\ldots,d_n) = d$ und $\sem{\Compose_n}_E(\zeta,e_1,\ldots,e_n) = e$,
    dann $(d,e) \in \Delta$.
  \item Wenn $\sem{\Child_n^i}_D(\hat{d}) = d$ und $\sem{\Child_n^i}_E(\hat{e}) = e$,
    dann $(d,e) \in \Delta$.
  \item $\sem{\Label}_D(\hat{d}) = \zeta$ gdw. $\sem{\Label}_E(\hat{e}) = \zeta$.
  \end{enumerate}
\end{definition}
Zwei Belegungen $\varrho_D: \Var \pto D$ und $\varrho_E: \Var \pto E$ hei"sen \emph{$\Delta$-"aquivalent},
geschrieben $\varrho_D \sim_\Delta \varrho_E$, wenn gilt:
\begin{enumerate}
\item $\dom(\varrho_D) = \dom(\varrho_E)$
\item $\bigl(\varrho_D(X),\varrho_E(X)\bigr) \in \Delta$ f"ur alle $X \in \dom(\varrho_D)$
\end{enumerate}

\begin{lemma}
  Seien $D$, $E$ g"ultige, $\Delta$-"aquivalente $\Psi$-Implementierungen,
  und $\varrho_D \sim_\Delta \varrho_E$ mit $\Gamma \vdash \varrho_D$ und $\Gamma \vdash \varrho_E$.
  \begin{enumerate}
  \item Wenn $\Tj{\Gamma}{\pi}{\tau}$, dann
    $D\sem{\Tj{\Gamma}{\pi}{\tau}}\,\varrho_D \sim_\Delta E\sem{\Tj{\Gamma}{\pi}{\tau}}\,\varrho_E$.
  \item Wenn $\Tj{\Gamma}{t}{\tau}$, dann
    $(D\sem{\Tj{\Gamma}{t}{\tau}}\,\varrho_D,E\sem{\Tj{\Gamma}{t}{\tau}}\,\varrho_E) \in \Delta$.
  \end{enumerate}
\end{lemma}

\begin{proof} \
  \begin{enumerate}
  \item Via Induktion "uber die L"ange der Herleitung des Typurteils $\Tj{\Gamma}{\pi}{\tau}$ und
    Fallunterscheidung nach der zuletzt angewendeten Regel:
    \begin{itemize}
    \item $\Tj{\Gamma}{\any}{\tau}$ mit \textsc{(Any)}

      Klar, denn nach Voraussetzung gilt $D^\tau \sim_\Delta E^\tau$ f"ur alle $\tau \in \Type$.

    \item $\Tj{\Gamma}{\pi \as X}{\tau}$ mit \textsc{(As)}

      Nach Lemma~\ref{lem:Wohldefiniertheit_der_Semantik} ex. $D'' \subseteq D' \subseteq D^\tau$ und
      $E'' \subseteq E' \subseteq E^\tau$ mit
      \begin{mathpar}
        D\sem{\Tj{\Gamma}{\pi \as X}{\tau}}\,\varrho_D = D''
        \and
        D\sem{\Tj{\Gamma}{\pi}{\tau}}\,\varrho_D = D'
        \and
        E\sem{\Tj{\Gamma}{\pi \as X}{\tau}}\,\varrho_E = E''
        \and
        E\sem{\Tj{\Gamma}{\pi}{\tau}}\,\varrho_E = E'
      \end{mathpar}
      und nach I.V. gilt $D' \sim_\Delta E'$.

    \item $\Tj{\Gamma}{\zeta(\pi_1,\ldots,\pi_n)}{\langle \rangle}$ mit \textsc{(Cons)}

      \textbf{TODO}
    \end{itemize}

  \item Via Induktion "uber die L"ange der Herleitung des Typurteils $\Tj{\Gamma}{t}{\tau}$
    Fallunterscheidung nach der zuletzt angewendeten Regel:
    \begin{itemize}
    \item $\Tj{\Gamma}{X}{\tau}$ mit \textsc{(Var)}

      Trivial.

    \item $\Tj{\Gamma}{t \langle t_1,\ldots,t_n \rangle}{\langle \rangle}$ mit \textsc{(App)}

      Nach Lemma~\ref{lem:Wohldefiniertheit_der_Semantik} ex. $d \in D^{\langle \sigma_1,\ldots,\sigma_n \rangle}$,
      $d_1,\ldots,d_n \in D^{\langle \rangle}$, $e \in E^{\langle \sigma_1,\ldots,\sigma_n \rangle}$ und
      $e_1,\ldots,e_n \in E^{\langle \rangle}$ mit
      \begin{mathpar}
        d = D\sem{\Tj{\Gamma}{t}{\langle\sigma_1,\ldots,\sigma_n\rangle}}\,\varrho_D
        \and
        d_i = D\sem{\Tj{\Gamma}{t_i}{\langle \rangle}}\,\varrho_D
        \and
        e = E\sem{\Tj{\Gamma}{t}{\langle\sigma_1,\ldots,\sigma_n\rangle}}\,\varrho_E
        \and
        e_i = E\sem{\Tj{\Gamma}{t_i}{\langle \rangle}}\,\varrho_E
      \end{mathpar}
      und nach I.V. gilt $(d_0,e_0) \in \Delta$ und $(d_i,e_i) \in \Delta$ f"ur $i=1,\ldots,n$.
      Nach Lemma~\ref{lem:Wohldefiniertheit_der_Semantik} ex. weiterhin
      $\hat{d} \in D^{\langle \rangle}$ und $\hat{e} \in E^{\langle \rangle}$ so dass
      \begin{mathpar}
        \hat{d}
        = D\sem{\Tj{\Gamma}{t \langle t_1,\ldots,t_n \rangle}{\langle \rangle}}\,\varrho_D
        = \sem{App_n}_D(d,d_1,\ldots,d_n)
        \and
        \hat{e}
        = E\sem{\Tj{\Gamma}{t \langle t_1,\ldots,t_n \rangle}{\langle \rangle}}\,\varrho_E
        = \sem{App_n}_E(e,e_1,\ldots,e_n)
      \end{mathpar}
      und mit Definition~\ref{def:Aequivalenz_von_Implementierungen} folgt daraus die Behauptung
      $(\hat{d},\hat{e}) \in \Delta$.

    \item $\Tj{\Gamma}{\zeta(t_1,\ldots,t_n)}{\langle \rangle}$ mit \textsc{(Cons)}

      Analog zum Fall der \textsc{(App)} Regel.
    \end{itemize}
  \end{enumerate}
\end{proof}


\cleardoublepage

\noindent
\textcolor{red}{
\rule{\textwidth}{2pt}
\vspace*{10pt}
\begin{center}
\mbox{\Huge\sf Obsolete}
\end{center}
\vspace*{10pt}
\rule{\textwidth}{2pt}
}

\subsection*{Substitutionsmodell}

Sei $\Omega=\langle C,\arity \rangle$ eine Syntaxsignatur einer beliebigen Programmiersprache.
\[\begin{grammar}
  e \in \Exp
  \is \id
  \al \zeta(e_1,\ldots,e_n) & n \in \N
  \al \Lambda\id:\tau.e
  \nl
  \tau \in \Type
  \is \Void
  \al \Dynamic
  \al \Static{n} & n \in \N
\end{grammar}\]

\begin{mathpar}
  \inferrule[(Id)]{%
  }{%
    \Omega \vdash \id \div \Void
  }
  \and
  \inferrule[(Bind)]{%
    \Omega \vdash e \div \Void
  }{%
    \Omega \vdash \Lambda\id:\tau.e \div \tau
  }
  \and
  \inferrule[(Cons)]{%
    \Omega \vdash \zeta \div (\tau_1,\ldots,\tau_n)
    \\
    \Omega \vdash e_1 \div \tau_1
    \\
    \ldots
    \\
    \Omega \vdash e_n \div \tau_n
  }{%
    \Omega \vdash \zeta(e_1,\ldots,e_n) \div \Void
  }
\end{mathpar}

\subsubsection*{Algebra}

\begin{itemize}
\item $\sem{\nstyle{exp}}_S = \Exp$
\item $\sem{\nstyle{label}}_S = F$
\item $\sem{\nstyle{nat}}_S = \N$
\end{itemize}

\[\begin{array}{rll}
  \sem{label}_S: & \Exp \pto F, \\
  & f(\vec{e}) \mapsto f \\
  \\\\
  \sem{child}_S: & \Exp \times \N \pto \Exp, \\
  & (f(e_1,\ldots,e_n),i) \mapsto e_i & 1 \le i \le n \\
  \\\\
  \sem{compose_n}_S: & F \times \underbrace{\Exp \times \ldots \times \Exp}_n \to \Exp, \\
  & (f, e_1,\ldots,e_n) \mapsto f(e_1,\ldots,e_n) \\
  \\\\
  \sem{subst}_S: & \Exp \times \Exp \pto \Exp, \\
  & (\Lambda\id:\tau.e',e) \mapsto e'[e/\id] \\
\end{array}\]


\subsection*{Umgebungsmodell}

Seien $\Cl$ und $\Env$ wie folgt induktiv definiert:
\[\begin{grammar}
  \eta \in \Env
  \is \varepsilon
  \al \id:\cl;\eta
  \nl
  \cl \in \Cl
  \is (e,\eta)
  \al f(\cl_1,\ldots,\cl_n)
\end{grammar}\]
$\dom(\eta)$ und $\eta(\id)$ sind wie folgt induktiv definiert:
\[\begin{array}{rcl}
  \dom(\varepsilon) &=& \emptyset \\
  \dom(\id:\cl;\eta) &=& \{\id\} \cup \dom(\eta) \\
  \\
  (\id:\cl;\eta)(\id) &=& \cl \\
  (\id':\cl';\eta)(\id) &=& \eta(\id) \\
\end{array}\]

\subsubsection*{Algebra}

\begin{itemize}
\item $\sem{\nstyle{exp}}_\Env = \Cl$
\item $\sem{\nstyle{label}}_\Env = F$
\item $\sem{\nstyle{nat}}_\Env = \N$
\end{itemize}

\[\begin{array}{rll}
  \sem{label}_\Env: & \Cl \pto F, \\
  & (\id,\eta) \mapsto f & f = \sem{label}_\Env(\cl) \wedge \cl = \eta(\id) \\
  & (e,\eta) \mapsto f & f = \sem{label}_S(e) \\
  & f(\vec{\cl}) \mapsto f \\
  \\\\
  \sem{child}_\Env: & \Cl \times \N \pto \Cl, \\
  & ((\id,\eta),i) \mapsto \cl_i & \cl_i = \sem{child}_\Env(\cl, i) \wedge \cl = \eta(\id) \\
  & ((e,\eta),i) \mapsto (e_i,\eta) & e_i = \sem{child}_S(e,i) \\
  & f(\vec{\cl}) \mapsto \cl_i & 1 \le i \le n \\
  \\\\
  \sem{compose_n}_\Env: & \multicolumn{2}{l}{F \times \underbrace{\Cl \times \ldots \times \Cl}_n \to \Cl,} \\
  & \multicolumn{2}{l}{(f,\vec{\cl}) \mapsto f(\vec{\cl})} \\
  \\\\
  \sem{subst}_\Env: & \multicolumn{2}{l}{\Cl \times \Cl \pto \Cl,} \\
  & \multicolumn{2}{l}{((\Lambda\id:\tau.e,\eta),\cl) \mapsto (e,\id:\cl;\eta)}
\end{array}\]


\subsection*{Zusammenhang}

Die \"Ubersetzungsfunktion $\tr:\Cl\to\Exp$ ist wie folgt induktiv definiert:
\[\begin{array}{rcll}
  \tr(e,\eta)
  &=& e[\eta(\id_i)/\id_i]^{i=1 \ldots n}
  & \dom(\eta) = \{\id_1,\ldots,\id_n\}
  \\
  \tr(f(\cl_1,\ldots,\cl_n))
  &=& f(\tr(\cl_1),\ldots,\tr(\cl_n))
\end{array}\]

\begin{lemma}
  F\"ur alle $f \in F$ und $\cl \in \Cl$ gilt:
  \begin{quote}
  $f = \sem{label}_\Env(\cl)$ gdw. $f = \sem{label}_S(\tr(\cl))$
  \end{quote}
\end{lemma}

\begin{proof}
  Via Induktion \"uber $\cl$:
  \begin{itemize}
  \item $\cl = (\id,\eta)$

    Wenn $\id \not\in \dom(\eta)$, dann sind beide undefiniert.

    Wenn $\id \in \dom(\eta)$, dann ex. $\cl' = \eta(\id)$, und nach I.V. gilt
    \begin{quote}
      $f = \sem{label}_\Env(\cl')$ gdw. $f = \sem{label}_S(\tr(\cl'))$.
    \end{quote}
    Es gilt $\sem{label}_\Env(\cl) = \sem{label}_\Env(\cl')$ und
    $\tr(\cl) = \tr(\cl')$, also folgt die Behauptung.

  \item $\cl = (e,\eta)$

    Es gilt $\sem{label}_S(e) = \sem{label}_S(\tr(e,\eta))$, also klar.

  \item $\cl = f(\cl_1,\ldots,\cl_n)$

    Trivial.

  \end{itemize}
\end{proof}

\begin{lemma}
  F\"ur alle $\cl,\cl' \in \Cl$ und $i \in \N$ gilt:
  \begin{quote}
    $\cl' = \sem{child}_\Env(\cl,i)$ gdw. $\tr(\cl') = \sem{child}_S(\tr(\cl),i)$
  \end{quote}
\end{lemma}

\begin{proof}
  \textbf{TODO}
\end{proof}

\begin{lemma}
  F\"ur alle $n \in \N$, $f \in F$ und $\cl_1,\ldots,\cl_n \in \Cl$ gilt:
  \begin{quote}
    $\tr(\sem{compose_n}_\Env(f,\cl_1,\ldots,\cl_n)) = \sem{compose_n}_S(f,\tr(\cl_1),\ldots,\tr(\cl_n))$
  \end{quote}
\end{lemma}

\begin{proof}
  Offensichtlich.
\end{proof}

\begin{lemma}
  F\"ur alle $\cl,\cl',\cl''\in\Cl$ gilt:
  \begin{quote}
    $\cl'' = \sem{subst}_\Env(\cl',\cl)$ gdw. $\tr(\cl'') = \sem{subst}_S(\tr(\cl'),\tr(\cl))$
  \end{quote}
\end{lemma}

\begin{proof}
  \textbf{TODO}
\end{proof}


\subsection*{Patterns}



\end{document}