\documentclass[12pt,a4paper,bigheadings]{scrartcl}

\usepackage{amssymb}
\usepackage{amstext}
\usepackage{amsmath}
\usepackage{array}
\usepackage[ngerman]{babel}
\usepackage{color}
\usepackage{enumerate}
%\usepackage[T1]{fontenc}
\usepackage{german}
\usepackage[a4paper,%
            colorlinks=false,%
            final,%
            pdfkeywords={},%
            pdftitle={},%
            pdfauthor={Benedikt Meurer},%
            pdfsubject={},%
            pdfdisplaydoctitle=true]{hyperref}
\usepackage[latin1]{inputenc}
\usepackage{latexsym}
\usepackage[final]{listings}
\usepackage{makeidx}
%\usepackage{mathpartir}
\usepackage{ngerman}
\usepackage[standard,thmmarks]{ntheorem}
\usepackage{scrpage2}
\usepackage{stmaryrd}
%\usepackage[DIV13,BCOR5mm]{typearea}
\usepackage{url}
\usepackage[all]{xy}

%% TP-Makros
\include{TP}

\newcommand{\semantic}[1]{\ensuremath{\llbracket#1\rrbracket}}
\newcommand{\assn}{\ensuremath{\mathbf{assn}}}
\newcommand{\atype}[1]{#1\,\assn}
\newcommand{\bexpr}{\ensuremath{\mathbf{expr}}}
\newcommand{\TEnv}{\name{TEnv}}
\newcommand{\Dtype}{\name{DType}}
\newcommand{\Atype}{\name{AType}}
\newcommand{\Assn}{\name{Assn}}
\newcommand{\Term}{\name{Term}}
\newcommand{\locns}{\name{locns}}
\newcommand{\reach}{\name{reach}}
\newcommand{\reachable}{\name{reachable}}
\newcommand{\tto}{\ensuremath{\xrightarrow{t}}}
\renewcommand{\disjoint}[2]{\ensuremath{#2\not\hookrightarrow#1}}
\newcommand{\view}[1]{\ensuremath{\app{\name{view}}{#1}}}
\newcommand{\RN}[1]{\mbox{{\sc (#1)}}}
\newcommand{\Tje}[3]{#1 \,\tr_e\, #2\cc#3}


\begin{document}

\section{Syntax der Logik}

\subsection{Typen}

Sei $\Type$ die Menge aller {\em Typen} $\tau$ der Programmiersprache. Darauf definieren wir 
\begin{itemize}
  \item die Menge $\Dtype$ aller {\em Datentypen} $\delta$,
  \item die Menge $\Atype$ aller {\em assertion types} $\theta$ und
  \item die Menge $\Ltype$ aller {\em logischen Typen} $\pi$
\end{itemize}
durch
\[\bgram
\delta  \is \tau
        \al \delta_1 \tto \delta_2
        \n
\theta  \is \assn
        \al \delta \tto \theta
        \n
\pi \is \delta
    \al \theta
    \n
\egram\]

\subsection{Terme und Formeln}

Sei $\Exp$ die Menge aller {\em Ausdr"ucke} $e$ und $\Val$ die Menge aller {\em Werte} $v$
der Programmiersprache (wobei angenommen wird, dass $\Id \subseteq \Val$). Darauf definieren wir 
\begin{itemize}
  \item die Menge $F$ aller {\em Funktionszeichen} $f$,
  \item die Menge \name{Term} aller {\em Terme} $t$,
  \item die Menge \name{Assn} aller {\em assertions} $p,q$ sowie
  \item die Menge \name{Formula} aller {\em (Hoare-)Formeln} $h$
\end{itemize}
durch
\[\bgram
f \is + \mid - \mid * \mid < \mid > \mid \le \mid \ge \mid \Cons \mid \ldots
  \n
t \is v
  \al f
  \al \app{t_1}{t_2}
  \al \abstr{\id:\delta}{t}
  \n
p,q \is t_1 \mapsto t_2
    \al \disjoint{p}{v}
    \al \app{p}{t}
    \al \abstr{\id:\delta}{p}
    \al \neg p
    \al p \wedge q
    \al \exists \id:\pi\in[v]. p
    \al h
    \n
h \is \triple{p}{e}{q}
  \al t_1 = t_2
  \al \neg h
  \al h_1 \wedge h_2
  \al \exists \id:\delta. h
\egram\]

\subsubsection{Syntaktischer Zucker}

Unter anderem folgende Konventionen:
\[\begin{array}{rcl}
  \triple{p}{e}{\ret{\id:\tau}{q}} &\equiv& \triple{p}{e}{\abstr{\id:\tau}{q}} \\
  \{p\} &\equiv& \triple{\true}{()}{\ret{u:\unit}{p}} \\
  && \text{mit $u \not \in \free{p}$}
\end{array}\]
Mglw. k"onnte man dar"uberhinaus:
\[\begin{array}{rcl}
  \exists \id:\delta.h &\equiv& \{\exists \id:\delta\in [\true]. h\}
\end{array}\]
W"are noch zu pr"ufen, z.B. indem man zun"achst die Hoare-Formel beibeh"alt und
dann anhand der Semantik zeigt, dass "aquivalent.


\section{Typregeln f"ur die Logik}

Der Begriff {\em Typumgebung} wird verallgemeinert f"ur die Logik. Eine {\em Typumgebung} ist
damit eine partielle Funktion
\[
  \Gamma: \Id \pto \Ltype
\]
mit endlichem Definitionsbereich. {\em Typurteile} f"ur die Logik sind von der Form
\[\begin{array}{l}
  \Tje{\Gamma}{e}{\tau} \\
  \Tj{\Gamma}{t}{\delta} \\
  \Tj{\Gamma}{p}{\theta} \\
  \Tjh{\Gamma}{h}
\end{array}\]
F"ur Typurteile $\Tje{\Gamma}{e}{\tau}$ der Programmiersprache gelten die "ublichen Typregeln.
F"ur die "ubrigen Typurteile werden neue Typregeln ben"otigt.

Die g"ultigen Typurteile f"ur assertions erhalten wir mit den Regeln \\[3mm]
\begin{tabular}{rl}
  \RN{P-App} & $\regel{\Tj{\Gamma}{p}{\delta \tto \theta} \quad \Tj{\Gamma}{t}{\delta}}
                      {\Tj{\Gamma}{\app{p}{t}}{\theta}}$ \\[1mm]
  \RN{P-Content} & $\regel{\Tj{\Gamma}{t_1}{\reftype{\tau}} \quad \Tj{\Gamma}{t_2}{\tau}}
                          {\Tj{\Gamma}{t_1 \mapsto t_2}{\assn}}$ \\[1mm]
  \RN{P-Abstr} & $\regel{\Tj{\Gamma[\delta/\id]}{p}{\theta}}
                        {\Tj{\Gamma}{\abstr{\id:\delta}{p}}{\delta \tto \theta}}$ \\[1mm]
  \RN{P-Disjoint} & $\regel{\Tj{\Gamma}{v}{\tau} \quad \Tj{\Gamma}{p}{\theta}}
                           {\Tj{\Gamma}{\disjoint{p}{v}}{\assn}}$ \\[1mm]
  \RN{P-Not} & $\regel{\Tj{\Gamma}{p}{\assn}}
                      {\Tj{\Gamma}{\neg p}{\assn}}$ \\[1mm]
  \RN{P-And} & $\regel{\Tj{\Gamma}{p_1}{\assn} \quad \Tj{\Gamma}{p_2}{\assn}}
                      {\Tj{\Gamma}{p_1 \wedge p_2}{\assn}}$ \\[1mm]
  \RN{P-Exists} & $\regel{\Tj{\Gamma}{v}{\tau} \quad \Tj{\Gamma[\pi/\id]}{p}{\assn}}
                         {\Tj{\Gamma}{\exists \id:\pi\in[v].p}{\assn}}$ \\[1mm]
  \RN{P-Hoare} & $\regel{\Tjh{\Gamma}{h}}
                        {\Tj{\Gamma}{h}{\assn}}$
\end{tabular} \\[3mm]
die g"ultigen Typurteile f"ur Terme erhalten wir mit den Regeln \\[3mm]
\begin{tabular}{rl}
  \RN{T-Val} & $\regel{\Tje{\Gamma}{v}{\tau} \quad \locns(v)=\emptyset}
                      {\Tj{\Gamma}{v}{\tau}}$ \\[1mm]
  \RN{T-Func} & $\regel{\tj{f}{\delta}}
                       {\Tj{\Gamma}{f}{\delta}}$ \\[1mm]
  \RN{T-App} & $\regel{\Tj{\Gamma}{t_1}{\delta \tto \delta'} \quad \Tj{\Gamma}{t_2}{\delta}}
                      {\Tj{\Gamma}{\app{t_1}{t_2}}{\delta'}}$ \\[1mm]
  \RN{T-Abstr} & $\regel{\Tj{\Gamma[\delta/\id]}{t}{\delta'}}
                        {\Tj{\Gamma}{\abstr{\id:\delta}{t}}{\delta \tto \delta'}}$ \\[1mm]
\end{tabular} \\[3mm]
und die g"ultigen Typurteile f"ur Hoare-Formeln mit \\[3mm]
\begin{tabular}{rl}
  \RN{H-Eq} & $\regel{\Tj{\Gamma}{t_1}{\delta} \quad \Tj{\Gamma}{t_2}{\delta}}
                     {\Tjh{\Gamma}{t_1 = t_2}}$ \\[1mm]
  \RN{H-Tc} & $\regel{\Tj{\Gamma}{p}{\assn} \quad \Tje{\Gamma}{e}{\tau} \quad \Tj{\Gamma}{q}{\tau} \tto \assn}
                     {\Tjh{\Gamma}{\triple{p}{e}{q}}}$ \\[1mm]
  \RN{H-Not} & $\regel{\Tjh{\Gamma}{h}}
                      {\Tjh{\Gamma}{\neg h}}$ \\[1mm]
  \RN{H-And} & $\regel{\Tjh{\Gamma}{h_1} \quad \Tjh{\Gamma}{h_2}}
                      {\Tjh{\Gamma}{h_1 \wedge h_2}}$ \\[1mm]
  \RN{H-Exists} & $\regel{\Tjh{\Gamma[\delta/\id]}{h}}
                         {\Tjh{\Gamma}{\exists \id:\delta.h}}$
\end{tabular}


\section{Speicherzust"ande und Erreichbarkeit}

F"ur jeden Typ $\tau$ sei eine unendliche Menge $\Loc^\tau$ definiert, deren Elemente $X,Y,\ldots$
als {\em Speicherpl"atze} vom Typ $\tau$ bezeichnet werden. Es wird vorausgesetzt, dass die Mengen
$\Loc^\tau$ paarweise disjunkt sind und darauf ist definiert
\[
  \Loc = \bigcup_{\tau\in\Type} \Loc^\tau
\]
Wir schreiben $\locns{e}$ f"ur die Menge aller im Ausdruck $e$ (syntaktisch) vorkommenden Speicherpl"atze
und $\Val^\tau$ f"ur die Menge aller abgeschlossenen Werte vom Typ $\tau$ (wobei Abgeschlossenheit sich
hier nur auf die Bezeichner $\Id$ beschr"ankt). Unter einem {\em Speicherzustand} verstehen wir eine
endliche partielle Funktion
\[
  \sigma: \Loc \pto \bigcup_{\tau\in\Type} \semantic{\tau}
\]
f"ur die gilt:
\begin{itemize}
  \item $\sigma(\Loc^\tau) \subseteq \Val^\tau$ f"ur alle $\tau\in\Type$
  \item $\locns(\sigma(X)) \subseteq \dom{\sigma}$ f"ur alle $X\in\Loc$
\end{itemize}
Demzufolge ist ein Zustand per Definition stets {\em wohlgetypt} und in sich abgeschlossen,
d.h. er enth"alt keine {\em dangling references}.

Mit $\Store$ bezeichnen wir die Menge aller Speicherzust"ande und f"ur jede endliche Menge
$L \subseteq \Loc$ definieren wir
\[
  \Store_L = \{\sigma\in\Store\,|\,L\subseteq\dom{\sigma}\}
\]

F"ur $\sigma\in\Store_L$ seien die Mengen $\name{reach}_i(L,\sigma)\subseteq \Loc$ f"ur alle
$i\in\setN$ und die Menge $\name{reach}(L,\sigma)\subseteq\Loc$ definiert durch
\[\begin{array}{rcl}
  \name{reach}_0(L,\sigma) & = & L \\
  \name{reach}_{i+1}(L,\sigma) & = & \name{reach}_i(L,\sigma)
             \cup \bigcup_{X\in\name{reach}_i(L,\sigma)} \locns(\sigma(X)) \\
  \name{reach}(L,\sigma) & = & \bigcup_{i\in\setN} \name{reach}_i(L,\sigma)
\end{array}\]
$\name{reach}(L,\sigma)$ enth"alt alle Speicherpl"atze, die man von der Menge $L$ aus im
Zustand $\sigma$ erreichen kann. Da ein Zustand $\sigma\in\Store_L$ keine dangling references
enth"alt, gilt stets
\[
  \name{reach}(L,\sigma) \subseteq \dom{\sigma}.
\]

\begin{lemma} \label{lemma:Store_L_und_reach}
  Seien $L,L'\subseteq\Loc$ endl., $L \subseteq L'$ und $\sigma,\sigma'\in\Store_{L'}$. Dann gilt:
  \begin{enumerate}
    \item $\Store_{L'} \subseteq \Store_{L}$
    \item $\reach(L,\sigma) \subseteq \reach(L',\sigma)$
    \item Wenn $\reach(L',\sigma) = \reach(L',\sigma')$ und $\sigma(X) = \sigma'(X)$ f.a.
          $X\in\reach(L',\sigma)$, dann $\reach(L,\sigma) = \reach(L,\sigma')$
  \end{enumerate}
\end{lemma}

\begin{beweis} \
  \begin{enumerate}
    \item Sei $\sigma''\in\Store_{L'}$, dann gilt $L' \subseteq \dom{\sigma''}$. Aus $L \subseteq L'$ folgt
          $L\subseteq\dom{\sigma''}$, also $\sigma''\in\Store_L$.
    \item Straight-forward induction.
    \item Straight-forward induction.
  \end{enumerate}
\end{beweis}

\begin{definition}[$L$-"Aquivalenz]
  Sei $L \subseteq \Loc$ endlich. Zwei Zust"ande $\sigma,\sigma'\in\Store$ hei"sen {\em $L$-"aquivalent}, geschrieben
  $\sigma \equiv_L \sigma'$, wenn entweder
  \begin{itemize}
    \item $\sigma = \sigma'$, oder
    \item $\sigma,\sigma'\in\Store_L$, $\name{reach}(L,\sigma) = \name{reach}(L,\sigma')$
          und $\sigma(X) = \sigma'(X)$ f"ur alle $X \in \reach(L,\sigma)$
  \end{itemize}
  gilt.
\end{definition}

\begin{lemma} \label{lemma:L_Aequivalenz}
  Seien $L,L'\subseteq\Loc$ endl. mit $L \subseteq L'$ und $\sigma,\sigma'\in\Store$. Wenn $\sigma \equiv_{L'} \sigma'$,
  dann $\sigma \equiv_L \sigma'$.
\end{lemma}

\begin{beweis}
  Klar f"ur $\sigma = \sigma'$. Sonst folgt die Behauptung mit Lemma~\ref{lemma:Store_L_und_reach}.
\end{beweis}

\begin{definition}[$L$-Definierbarkeit]
  Sei $\phi : \Store \to \Bool$ und sei weiter $L$ eine endl. Teilmenge von $\Loc$.
  $\phi$ hei"st {\em $L$-definierbar}, wenn f"ur alle $\sigma,\sigma'\in\Store$ mit
  $\sigma \equiv_L \sigma'$ gilt: $\phi\,\sigma = \phi\,\sigma'$.
\end{definition}

\begin{lemma} \label{lemma:L_Definierbarkeit}
  Seien $L,L'\subseteq\Loc$ mit $L \subseteq L'$ und sei $\phi:\Store \to \Bool$. Ist $\phi$ $L$-definierbar,
  so ist $\phi$ ebenfalls $L'$-definierbar.
\end{lemma}

\begin{beweis}
  Folgt leicht mit Lemma~\ref{lemma:L_Aequivalenz}.
\end{beweis}


\section{Semantik der Logik}

\subsection{Semantische Bereiche}

F"ur alle Typen $\pi$ und alle endl. $L \subseteq \Loc$ werden induktiv $L$-definierbare
sematische Bereiche $\semantic{\pi}_L$ und definiert. Daraus ergeben sich die eigentlichen
semantischen Bereiche $\semantic{\pi} = \bigcup\limits_{L \text{ endl.}} \semantic{\pi}_L$.
\[\begin{array}{rcl}
  \semantic{\tau}_L &:=& \{v \in \Val^\tau\,|\,\locns(v) \subseteq L\} \\
  \semantic{\assn}_L &:=& \{\phi:\Store\to\Bool\,|\,\text{$\phi$ ist $L$-definierbar und $\dom{\phi}=\Store_L$}\} \\
  \semantic{\delta\tto\pi}_L &:=& \{f:\semantic{\delta}\to\semantic{\pi}\,|\,
                                    f(\semantic{\delta}_{L'}) \subseteq \semantic{\pi}_{L\cup L'}
                                    \text{ f"ur alle endl. $L'\subseteq\Loc$}\} 
\end{array}\]

\begin{lemma}
  Seien $L,L'\subseteq\Loc$ endl. und $\pi\in\Ltype$. Wenn $L\subseteq L'$, dann
  $\semantic{\pi}_{L} \subseteq \semantic{\pi}_{L'}$.
\end{lemma}

\begin{beweis}
  Induktion "uber die Struktur von $\pi$:
  \begin{itemize}
    \item Sei $v \in \semantic{\tau}_L$, dann ist $\locns(v)\subseteq L \subseteq L'$, also auch $v\in\semantic{\tau}_{L'}$.
    \item Sei $\phi \in \semantic{\assn}_L$, dann ist $\phi$ $L$-definierbar und nach Lemma~\ref{lemma:L_Definierbarkeit}
          ebenfalls $L'$-definierbar, also auch $\phi \in \semantic{\assn}_{L'}$.
    \item Sei $f\in\semantic{\delta \tto \pi}_L$, dann gilt $f(\semantic{\delta}_{L''}) \subseteq \semantic{\pi}_{L\cup L''}$
          f.a. endl. $L''\subseteq\Loc$. Nach I.V. gilt $\semantic{\pi}_{L\cup L''} \subseteq \semantic{\pi}_{L'\cup L''}$,
          also $f\in\semantic{\delta \tto \pi}_{L'}$.
  \end{itemize}
\end{beweis}

\begin{definition}[Totale Korrektheit]
  Seien $\tau\in\Type$, $f:\Store \pto \bigl(\semantic{\tau} \times \Store\bigr)$,
  $\phi\in\semantic{\assn}$ und $\psi \in \semantic{\tau \tto \assn}$. $f$ hei"st
  {\em total korrekt} bzgl. $\phi$ und $\psi$, wenn f"ur alle $\sigma\in\dom{\phi}$
  mit $\phi\,\sigma=\true$ ein $v\in\Val^\tau$ und ein $\sigma'\in\dom{\psi\,v}$
  existieren, so dass $f\,\sigma = (v,\sigma')$ und $\psi\,v\,\sigma'=\true$ gilt.
%  \[\begin{array}{l}
%    \forall \sigma\in\dom{\phi}.
%    \bigl[
%      \phi\,\sigma = \true 
%      \Rightarrow
%      \exists v\in\Val^\tau.
%      \exists \sigma'\in\dom{\psi\,v}.f\,\sigma = (v,\sigma')\wedge \psi\,v\,\sigma'=\true
%    \bigr]
%  \end{array}\]
\end{definition}


\subsection{Semantik von Termen und Formeln}

Eine {\em Umgebung} ist eine partielle Abbildung $\rho:\Id\pto\bigcup_{\tau\in\Type} \Val^\tau$.
Eine Umgebung $\rho$ {\em passt} zu einer Typumgebung $\Gamma$, geschrieben $\Gamma \models \rho$,
wenn gilt:
\begin{itemize}
  \item $\dom{\rho} = \dom{\Gamma}$
  \item $\rho(\id) \in \Val^{\Gamma(\id)}$ f"ur alle $\id\in\dom{\rho}$
\end{itemize}
Die Menge aller zu $\Gamma$ passenden Umgebungen ist:
\[
  \Env_\Gamma := \{\rho\,|\,\Gamma \models \rho\}
\]

\noindent
Ein Zustand $\sigma$ {\em passt} zu einer Umgebung $\rho$, geschrieben $\rho \models \sigma$,
wenn gilt:
\begin{itemize}
  \item $\locns(\rho(\id)) \subseteq \dom{\sigma}$ f"ur alle $\id\in\dom{\rho}$
  \item $\locns(\sigma(X)) \subseteq \dom{\sigma}$ f"ur alle $X\in\dom{\sigma}$
\end{itemize}
Die Menge aller zu $\rho$ passenden Zust"ande $\Store_\rho$ ist def. durch:
\[
  \Store_\rho := \{\sigma\,|\,\rho\models\sigma\}
\]

\noindent
Den (g"ultigen) Typurteilen f"ur Ausdr"ucke, Terme und Formeln wird nun eine Semantik zugeordnet:
\begin{itemize}
  \item $\semantic{\Tj{\Gamma}{t}{\delta}}:\Env_\Gamma \to \semantic{\delta}$
  \item $\semantic{\Tj{\Gamma}{p}{\theta}}:\Env_\Gamma \to \semantic{\theta}$
  \item $\semantic{\Tjh{\Gamma}{h}}: \Env_\Gamma \to \Bool$
  \item $\semantic{\Tje{\Gamma}{e}{\tau}}: \Env_\Gamma \to \bigl( \Store \pto (\semantic{\tau}\times\Store) \bigr)$
\end{itemize}

\noindent
F"ur Ausdr"ucke kann die Semantik wahlweise "uber small oder big step Semantik definiert
werden, z.B.
\[\begin{array}{rcl}
  \semantic{\Tje{\Gamma}{e}{\tau}}\,\rho\,\sigma = (v,\sigma')
  & :\Leftrightarrow &
  (e\rho,\sigma) \Downarrow (v,\sigma')
\end{array}\]
wobei $e \rho$ der Ausdruck ist, der aus $e$ entsteht, indem alle durch $\rho$ spezifizierten
Substitutionen ausgef"uhrt werden. Da $\Gamma \models \rho$, ist $e \rho$ somit ein abgeschlossener
Ausdruck vom Typ $\tau$.

\pagebreak[3] \noindent
Die Semantik von Termen ist definiert durch:
\[\begin{array}{rcl}
  \semantic{\Tj{\Gamma}{v}{\tau}}\,\rho
  & := &
  v\,\rho 
  \\
  \semantic{\Tj{\Gamma}{f}{\delta}}\,\rho
  & := &
  \semantic{\tj{f}{\delta}} \\
  && \text{wobei die Semantik hier noch zu def. ist}
  \\
  \semantic{\Tj{\Gamma}{\app{t_1}{t_2}}{\delta}}\,\rho
  & := &
  (\semantic{\Tj{\Gamma}{t_1}{\delta'\tto\delta}}\,\rho)\,(\semantic{\Tj{\Gamma}{t_2}{\delta'}}\,\rho)
  \\
  \semantic{\Tj{\Gamma}{\abstr{\id:\delta}{t}}{\delta\tto\delta'}}\,\rho\,d
  & := &
  \semantic{\Tj{\Gamma[\delta/\id]}{t}{\theta'}}\,(\rho[d/\id])
\end{array}\]

\pagebreak[3] \noindent
Die Semantik von assertions ist wie folgt induktiv definiert:
\[\begin{array}{rcl}
  \semantic{\Tj{\Gamma}{h}{\assn}}\,\rho\,\sigma
  & := &
  \semantic{\Tjh{\Gamma}{h}}\,\rho
  \\
  \semantic{\Tj{\Gamma}{\app{p}{t}}{\theta}}\,\rho
  & := &
  (\semantic{\Tj{\Gamma}{p}{\delta \tto \theta}}\,\rho)\,(\semantic{\Tj{\Gamma}{t}{\delta}}\,\rho)
  \\
  \semantic{\Tj{\Gamma}{\abstr{\id:\delta}{p}}{\delta \tto \theta}}\,\rho\,d
  & := &
  \semantic{\Tj{\Gamma[\delta/\id]}{p}{\theta}}\,(\rho[d/\id])
  \\
  \\
  \semantic{\Tj{\Gamma}{t_1\mapsto t_2}{\assn}}\,\rho\,\sigma
  & := &
    \bcase
      \true, & \text{wenn ex. $X\in\dom{\sigma}$ mit } X = \semantic{\Tj{\Gamma}{t_1}{\reftype{\tau}}}\,\rho \\
             & \text{und } \sigma(X) = \semantic{\Tj{\Gamma}{t_2}{\tau}}\,\rho \\
      \false, & \text{sonst}
    \ecase
  \\
  \\
  \semantic{\Tj{\Gamma}{\disjoint{p}{v}}{\assn}}\,\rho\,\sigma
  & := &
    \bcase
      \true, & \text{wenn ex. endl. $L,L'\subseteq\Loc$ mit } (v\rho)\in\semantic{\tau}_{L} \\
             & \text{und } (\semantic{\Tj{\Gamma}{p}{\theta}}\,\rho)\in\semantic{\theta}_{L'}, \text{ so dass } \\
             & \reach(L,\sigma) \cap \reach(L',\sigma) = \emptyset \\
      \false, & \text{sonst}
    \ecase
  \\
  \\
  \semantic{\Tj{\Gamma}{\neg p}{\assn}}\,\rho\,\sigma
  & := &
    \bcase
      \true, & \text{wenn } \semantic{\Tj{\Gamma}{p}{\assn}}\,\rho\,\sigma = \false \\
      \false, & \text{wenn } \semantic{\Tj{\Gamma}{p}{\assn}}\,\rho\,\sigma = \true
    \ecase
  \\
  \\
  \semantic{\Tj{\Gamma}{p_1 \wedge p_2}{\assn}}\,\rho\,\sigma
  & := &
    \bcase
      \true, & \text{wenn } \semantic{\Tj{\Gamma}{p_1}{\assn}}\,\rho\,\sigma = \true \\
             & \text{und } \semantic{\Tj{\Gamma}{p_2}{\assn}}\,\rho\,\sigma = \true \\
      \false, & \text{wenn } \semantic{\Tj{\Gamma}{p_1}{\assn}}\,\rho\,\sigma = \false \\
             & \text{oder } \semantic{\Tj{\Gamma}{p_2}{\assn}}\,\rho\,\sigma = \false
    \ecase
  \\
  \\
  \semantic{\Tj{\Gamma}{\exists \id:\pi \in [v].p}{\assn}}\,\rho\,\sigma
  & := &
    \bcase
      \true, & \text{wenn ex. $d\in\semantic{\pi}_{\locns(v)}$, so dass} \\
             & \semantic{\Tj{\Gamma[\pi/\id]}{p}{\assn}}\,(\rho[d/\id])\,\sigma = \true \\
      \false, & \text{sonst}
    \ecase
\end{array}\]

\noindent
Die Semantik von Hoare-Formeln ist dann definiert durch:
\[\begin{array}{rcl}
  \semantic{\Tjh{\Gamma}{t_1 = t_2}}\,\rho
  & := &
  \true, \text{ gdw. } \semantic{\Tj{\Gamma}{t_1}{\theta}}\,\rho = \semantic{\Tj{\Gamma}{t_2}{\theta}}\,\rho \\
  && \text{wobei die Gleichheit hier noch zu def. ist}
  \\
  \semantic{\Tjh{\Gamma}{\triple{p}{e}{q}}}\,\rho 
  & := &
  \true, \text{ gdw. } \semantic{\Tje{\Gamma}{e}{\tau}}\,\rho \text{ total korrekt bzgl. } \\
  && \semantic{\Tj{\Gamma}{p}{\assn}}\,\rho \text{ und } \semantic{\Tj{\Gamma}{q}{\tau \tto \assn}}\,\rho
  \\
  \semantic{\Tjh{\Gamma}{\neg h}}\,\rho
  & := &
  \true, \text{ gdw. } \semantic{\Tjh{\Gamma}{h}}\,\rho = \false
  \\
  \semantic{\Tjh{\Gamma}{h_1 \wedge h_2}}\,\rho
  & := &
  \true, \text{ gdw. } \semantic{\Tjh{\Gamma}{h_1}}\,\rho = \true \text{ und }
  \semantic{\Tjh{\Gamma}{h_2}}\,\rho = \true
  \\
  \semantic{\Tjh{\Gamma}{\exists \id:\delta.h}}\,\rho
  & := &
  \true, \text{ gdw. ex. } d \in \semantic{\delta} \text{ so dass }
  \semantic{\Tjh{\Gamma[\delta/\id]}{h}}\,(\rho[d/\id])=\true
\end{array}\]

\begin{satz}[Wohldefiniertheit der Semantik]
  Sei $L\subseteq\Loc$ endl., $\Gamma\in\TEnv$, $\rho\in\Env_\Gamma$ mit $\rho(\id)\in\semantic{\Gamma(\id)}_L$ f.a.
  $\id\in\dom{\rho}$. Dann gilt:
  \begin{itemize}
    \item F"ur alle $t\in\Term$, $\delta\in\Dtype$ mit $\Tj{\Gamma}{t}{\delta}$ gilt
          $(\semantic{\Tj{\Gamma}{t}{\delta}}\,\rho)\in\semantic{\delta}_L$.
    \item F"ur alle $p\in\Assn$, $\theta\in\Atype$ mit $\Tj{\Gamma}{p}{\theta}$ gilt
          $(\semantic{\Tj{\Gamma}{p}{\theta}}\,\rho)\in\semantic{\theta}_L$.
  \end{itemize}
\end{satz}

\begin{beweis}
  Simult. Induktion "uber $t$ und $p$ (oder die Typurteile):
  \begin{itemize}
    \item $\semantic{\Tj{\Gamma}{v}{\tau}}\,\rho = (v\,\rho) \in \semantic{\tau}_L$, da $\locns(v) = \emptyset$.

    \item F"ur $\phi = (\semantic{\Tj{\Gamma}{t_1 \mapsto t_2}{\assn}}\,\rho)$ sind nach I.V.
          $(\semantic{\Tj{\Gamma}{t_1}{\reftype{\tau}}}\,\rho)$ und $(\semantic{\Tj{\Gamma}{t_2}{\tau}}\,\rho)$
          wohldefiniert. Es ist zu zeigen, dass $\phi$ $L$-definierbar ist.

          Seien dazu o.B.d.A. $\sigma,\sigma'\in\Store_L$ mit $\reach(L,\sigma)=\reach(L,\sigma')$ und
          $\sigma(Y) = \sigma'(Y)$ f.a. $Y\in\reach(L,\sigma)$. Bleibt zu zeigen, dass $\phi\,\sigma=\phi\,\sigma'$:
          \begin{itemize}
            \item Angenommen $\phi\,\sigma=\true$, dann ex. ein $X \in \dom{\sigma}$ mit
                  $X=(\semantic{\Tj{\Gamma}{t_1}{\reftype{\tau}}}\,\rho) \in \semantic{\reftype{\tau}}_L \subseteq L$ und
                  $\sigma(X) = (\semantic{\Tj{\Gamma}{t_2}{\tau}}\,\rho)$. Nach Vor. gilt aber $\sigma(X)=\sigma'(X)$,
                  also folgt $\phi\,\sigma'=\true$.
            \item Analog f"ur die Gegenrichtung.
          \end{itemize}
  \end{itemize}
\end{beweis}

\begin{definition}[Modell] \
  \begin{itemize}
    \item $\rho$ heisst {\em Modell} von $\Tjh{\Gamma}{h}$, wenn $\semantic{\Tjh{\Gamma}{h}}\,\rho = \true$
          gilt, geschrieben als $\rho \models \Tjh{\Gamma}{h}$.
    \item Gilt $\rho \models \Tjh{\Gamma}{h}$ f"ur alle $\rho\in\Env_\Gamma$, so schreiben wir
          $\models \Tjh{\Gamma}{h}$ und nennen  $\Tjh{\Gamma}{h}$ {\em g"ultig}.
    \item Ist $\Gamma = [\,]$, so schreiben wir $\models h$.
  \end{itemize}
\end{definition}


\subsection{Zusammenh"ange}

\begin{lemma}[Allokations-Invarianz]
  F"ur alle $\Gamma\in\TEnv$, $\tau\in\Type$, $y\in\semantic{\tau}$, $p \in\Assn$ mit
  $x \not \in \free{p}$ und $\Tjh{\Gamma}{\triple{p}{\bref\,y}{\ret{x:\reftype{\tau}}{p}}}$ gilt:
  \[
    \models \Tjh{\Gamma}{\triple{p}{\bref\,y}{\ret{x:\reftype{\tau}}{p}}}
  \]
\end{lemma}



\section{Kalk"ul}

Ableitbarkeit: $\vdash h$

\subsection{Regeln}


\end{document}
